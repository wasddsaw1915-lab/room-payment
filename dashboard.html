<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; }
        .table-success-custom { background-color: #d1e7dd !important; }
        .form-check-input { width: 1.6em; height: 1.6em; cursor: pointer; }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<audio id="soundSuccess" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>
<audio id="soundReset" src="https://www.soundjay.com/buttons/sounds/button-11.mp3"></audio>

<nav class="navbar navbar-dark bg-primary shadow">
    <div class="container">
        <span class="navbar-brand fw-bold" id="navTitle">üí∞ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡πâ‡∏≠‡∏á</span>
        <button class="btn btn-light btn-sm fw-bold" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
</nav>

<div class="container mt-4">
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <input type="text" id="searchBox" class="form-control w-50" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠..." onkeyup="filterNames()">
                    <div id="date" class="badge bg-dark p-2 fs-6"></div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="mainTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card p-4 text-center mb-3 border-primary border-top border-4">
                <h5 class="text-muted">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</h5>
                <h1 id="totalAmount" class="display-4 fw-bold text-primary">0 ‡∏ö‡∏≤‡∏ó</h1>
            </div>

            <div id="adminArea">
                <button onclick="exportCSV()" class="btn btn-success w-100 mb-2 py-3 fw-bold shadow-sm">üì• Export Excel + ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</button>
                <button onclick="resetData()" class="btn btn-outline-danger w-100 py-2">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>

            <div id="guestArea" class="alert alert-warning d-none text-center fw-bold">
                ‚ö†Ô∏è ‡πÇ‡∏´‡∏°‡∏î‡∏î‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å)
            </div>
        </div>
    </div>
</div>

<script src="js/data.js"></script>
<script src="js/login.js"></script>
<script src="js/check.js"></script> <script>
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
    if (localStorage.getItem('login') !== 'true') {
        window.location.replace('index.html');
    }
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
    function startClock() {
        setInterval(() => {
            const now = new Date();
            document.getElementById('date').innerText = now.toLocaleString('th-TH');
        }, 1000);
    }

    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô togglePaid ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    const originalTogglePaid = window.togglePaid; 
    window.togglePaid = async function(i) {
        if (userRole === 'guest') return;
        
        // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡πä‡∏Å‡∏ñ‡∏π‡∏Å
        if (!paid[i]) {
            document.getElementById('soundSuccess').play().catch(e => console.log("Audio play failed"));
        }
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô js/check.js
        paid[i] = !paid[i];
        renderTable();
        await saveData(); 
    };

    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    function resetData() {
        if (confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÉ‡∏´‡∏°‡πà?")) {
            document.getElementById('soundReset').play().catch(e => console.log("Audio play failed"));
            paid = {};
            saveData(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Sheets
            renderTable();
        }
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠
    function filterNames() {
        let input = document.getElementById('searchBox').value.toUpperCase();
        let rows = document.getElementById('mainTable').getElementsByTagName('tr');
        for (let row of rows) {
            let name = row.getElementsByTagName('td')[1].innerText;
            row.style.display = name.toUpperCase().indexOf(input) > -1 ? "" : "none";
        }
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
    function exportCSV() {
        let csv = ['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà,‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢'];
        let count = 0;
        members.forEach((n, i) => {
            const isPaid = paid[i] ? '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '-';
            if (paid[i]) count++;
            csv.push(`${i+1},${n},${isPaid}`);
        });
        csv.push(''); 
        csv.push(`,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢,${count} ‡∏Ñ‡∏ô`);
        csv.push(`,‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô,${count * PRICE} ‡∏ö‡∏≤‡∏ó`);
        let blob = new Blob(['\uFEFF' + csv.join('\n')], { type: 'text/csv;charset=utf-8' });
        let a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô_${new Date().toLocaleDateString('th-TH')}.csv`;
        a.click();
    }

    startClock();
</script>
</body>
</html>
